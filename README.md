# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Интерфейсы

* `IAppData` - Данные приложения
* `IProduct` - Продукт
* `IOrder` - Заказ
* `IOrderResult` -Результат заказа 
* `ILarekApi` - Интерфейс для API
* `TFormErrors` - Тип данных ошибок валидации

## Архитектура проекта

Код прилолжения разделен на части MVP парадигмы

* Слой модель данных для пользовательского интерфейса
* Слой представление показывает пользователю интерфейс
* Слой презентер управляет моделью и представлением

## Базовый код

### Класс Component
Базовый абстрактный класс **Component** является родителем для других класов представления.

Методы:

* `toggleClass` - переключает классы элемента
* `setText` - устанавливает текстовое содержимое
* `setDisabled` - меняет состояние блокировки. Устанавливает если его нет, убирает если оно есть
* `setHidden` - скрывает элемент
* `setVisible` - показывает элемент
* `setImage` - устанавливает изображение
* `render` - заполняет элемент данными


### Кдасс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Методы класса EventEmitter:

* `on` - устанавливает оброботчик событий
* `off` - снимает обработчик событий
* `emit` - инициировать событие с данными
* `onAll` - устанавливает все оброботчики событий 
* `offAll` - снимает все обработчики событий


### Класс Api
Класс Api реализует запросы на сервер

Методы класа Api:
* `get` - отправляет GET запрос на сервер и возвращает промис
* `post` - принимает обьект с данными в формате json и отправляет запрос на сервер

## Cлой данных

### Класс Model
Класс **Model** является базовым абстрактным классом для работы с моделью данных

Методы:

* `emitChanges` - сообщает всем что модель изменилась

### Класс AppData
Класс **AppData** отвечает за работу с данными приложения\
Расширяет базовый абстрактный класс `Model<T>` по интерфейсу `IAppData`.

Поля:
* `_catalog` - массив с объектами карточек товара 
* `_basket` - содержет в себе массив с объектами карточек товара которые находятся в корзине
* `_order` - текущий заказ
* `_formErrors` - ошибки полей форм

Методы:

* `addProductToBasket` - добавление товара в корзину
* `removeProductFromBasket` - удаление товара из корзины
* `clearBasket` - очистка корзины
* `clearOrder` - очистка оформления заказа после успешной покупки
* `getBasket` - получаем товар из массива продуктов в корзину
* `getOrder` - метод для получения заказа товвра
* `setOrderField` - обновляет состояние полей форм
* `getTotalPrice` - выводит общую сумму заказа
* `setCatalog` - установка каталога товаров на странице
* `getCatalog` - получаем список товаров
* `getBasketCount` - метод для отработки счетка корзины
* `getPaymentMethod` - метод для выбора способа оплаты
* `validateOrder` - данные валидации
* `stateCard` - помогает нам убедится что товар уже находится в корзине 

### Класс LarekApi
Класс **LarekApi** отвечает за получение католога с товарами и оформление заказа.\
Данный класс наследует базовый класс `Api` и реализует интерфейс `ILarekApi`

Поле `cdn` хранит входящий `url`

Конструктор принимает входящий url, базовый url для api, необязательный параметр для инициализации запроса.

Методы:

* `getProducts` - отправляет запрос на получение списка всех товаров
* `createOrder` - отправляет запрос для оформления заказа с указанными данными

## Слой представления

 ### Класс Modal
Класс **Modal** отвечвет за открытие и закрытие всех модальных окон на странице.\
Данный класс расширяет абстрактный класс `Component<T>` при помощи интерфейса `IModal`.

Поля:
 * `_closeButton` - кнопка закрытия модального окна
 * `_content` - содержимое модального окна

Конструктор использует параметр `container` типа `HTMLElement` и инстант брокера событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки,\
и также установлены обработчики событий модального окна. 

Также в классе имеется сеттер для установки содержимого контента внутри контейнера.

Методы:

* `open` - открывает модальное окно
* `close` - закрывает модальное окно
* `render` - рендеринг отрисовка модалки


### Класс Basket
Класс **Basket** служит для отображания списка выбранного товара в корзину.
Данный класс расширяет абстрактный класс `Component<T>` при помощи интерфейса `IBasket`.

Поля:

* `_list` - контейнер список товаров в корзине
* `_total` - общая сумма заказа
* `_button` - кнопка для перехода к оформлению заказа 

Конструктор использует параметр `container` типа `HTMLElement` и инстант брокера событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик события для кнопки перехода к заказу товара.

Также в классе присутствует метод `disableButton` который позволяет блокировать кнопку для перехода к заказу

Использование сеттеров:
* `items` - устанавливает Html элемент в корзину\
 в случае если корзина пуста при помощи функции `createElement` создаётся элемент с текстом `Корзина пуста`\
 и блокируется кнопка перехода к заказу. 
* `total` - устанавливает общию сумму товаров в корзине.

### Класс Form<T>
Класс **Form** отвечает за работу с формами и ошибками полей форм.\
Расширяет абстрактный класс `Component<T>` при помощи интерфейса `IFormState`.

Поля:

* `_submit` - кнопка форм заказа
* `_errors` - элемент отображение ошибок формы

Конструктор использует параметр `container` типа `HTMLFormElement` и инстант брокера событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Слушатель `input` прикреплён ко всей форме `container`, он отслеживает и определяет имя поля и его значение.\
После чего отправляются методу  `onInputChange` в качестве аргументов.\
Слушатель `submit` прикреплён ко всей форме `container`, при помощи которого генерируется событие.\
`preventDefault()` предотвращает перезагрузку страницы по умолчанию.

Методы:

* `onInputChange` - метод обработки изменения поля ввода
* `render` - рендеринг отрисовка формы

Использование сеттеров:

* `valid` - установка валидности формы
* `errors` - установка ошибок валидации


### Класс Success
Класс **Success** уведомляет о успешном заказа в виде модального окна.\
Расширяет абстрактный класс `Component<T>` при помощи интерфейса `ISuccess`.

Поля: 

* `_buttonClose` - кнопка закрытия модального окна успешной покупки
* `_description` - элемент отображения теста и цены заказа

Конструктор использует параметр `container` типа `HTMLElement` и инстант брокера событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик для клика на кнопку `За новыми покупками`.

Использование ссетера `total` для установки итоговый суммы заказа в модальном окне.

### Класс Page
Класс **Page** отвечает за отображение содержимое страницы.\
Кдасс расширяет абстрактный класс `Component<T>` при помощи интерфейса `IPage`.

Поля:

* `_counter` - cчетчик корзины
* `_catalog` - каталог с товарами
* `_wrapper` - обертка страницы
* `_basket` - корзина

Конструктор использует параметр `container` типа `HTMLElement` и инстант брокера событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Добавлен обработчик для открытия модального окна корзины.

Использование сеттеров:

* `counter` - установка количества товаров в корзине
* `catalog` - установка содержимого каталога
* `locked` - установка блокировки прокрутки страницы 

### Класс CardProduct
Класс **CardProduct** отвечает за отображение карточки товара на главной странице.\
Данный класс расширяет абстрактный класс `Component<T>` при помощи интерфейса `ICardProduct`.

Поля: 
* `_title` - заголовок продукта
* `_image` - изображение товара
* `_category` - категория товара
* `_description` - описание товара
* `_price` - цена товара
* `_button` - кнопка добавление товара в корзину

Конструктор использует параметры `container` типа `HTMLElement` и `actions` типа `IActions`.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик для добавления товара в корзину.

Использование сеттеров:
* `category` - установка категории товара
* `title` - установка названия товара
* `image` - установка изображение товара
* `price` - установка цены товара
* `description` - установка описание товара
* `state` - установка состояние товара. если цена равна null(Бесценно) то меняется текст кнопки на `Недоступно`.
Если товар уже выбран в корзину, то меняется текст кнопки на `В корзине`
и блокируется кнопка добавление в корзину.

### Класс ProductInBasket
Класс **ProductInBasket** отвечает за отображение товара внутри корзины.
**ProductInBasket** является дочерним классом `CardProduct`.

Поля:

* `_index` - номер товара в корзине
* `_button` - кнопка удаление товара из корзины

Конструктор использует параметры `container` типа `HTMLElement` и `actions` типа\
`IActions`.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик событий для кнопки удаления товара из корзины.

Использование сеттеров:

* `index` - установка номера товара 

### Класс Order
Класс **Order** отвечает за начальный этап оформление заказа.
Расширяет класс `Form<T>` при помощи интерфейса `IOrder`.

Поля:

* `_buttonPaymentOnline` - способ оплаты онлайн
* `_buttonPaymentCash` - способ оплаты при получении
* `_inputAddress` - поле для указания адреса доставки
* `_buttonSubmit` - кнопка для продолжения заказа

Конструктор использует параметр `container` типа `HTMLFormElement` и инстант брокера событий.\
Параметр `container` и параметр `events` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Установлен обработчик событий для выбора способа оплаты и обработчик для продолжение оформление заказа.

Использование сеттеров:

* `payment` - Установка для выбора способы оплаты
* `address` -  Установка значение поля адрес

### Класс Contacts
Класс **Contacts** отвечает за продолжение заказа.\
Расширяет класс `Form<T>` при помощи интерфейса `IOrder`.

Поля:
* `_buttonSubmit` - кнопка отправление заказа

Конструктор использует параметр `container` типа `HTMLFormElement` и инстант брокера событий.\
Параметр `container` и параметр `events` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Установлен обработчик для отправки заказа.

Использование сеттеров:

* `phone` - Установка значение поля номера
* `email` - Установка значение электроной почты

## Слой представитель

За слой представителя он же презентер отвечает файл `src/index.js` внутри которого взаимодействуют слой представления и модели данных между собой, за счет брокера событий и экземпляров классов.
Сначала создаются экземпляры классов после чего устанавливаются обработчики событий.

### События:

* `products:changed` - изменение списка продуктов
* `basket:changed` - изменилось состояние списка товаров в корзине
* `order:changed` - изменилось состояние оформление заказа
* `order:ready` - если заказа действителен отправляется событие о готовности заказа
* `formErrors:changed` - изменилось состояние ошибок форм
* `product:openModal` - открытие модального окна превью товара
* `product:addToBasket` - добавление товара в корзину
* `product:removeFromBasket` - удаление товара из корзины
* `basket:open` - открытие корзины
* `/(^order|^contacts)\..*:change/` - изменилось состояние полей форм
* `order:open` - переход к оформлению заказа
* `contacts:open` - переход к форме контактов
* `order:submit` - отправка заказа
* `modal:open` - открытие модального окна
* `modal:close` - закрытие модального окна
* `success:close` - закрытие модального окна success