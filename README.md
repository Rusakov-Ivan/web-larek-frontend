# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных

Данные приложения
```
interface IAppData {
    catalog: IProduct[]
    basket: IProduct[]
    order: IOrder

}
```
Страница
```
interface IPage {
    counter: number
    catalog: HTMLElement[]
    locked: boolean
}
```
Данные модального окна
```
interface IModal {
    content: HTMLElement
}
```
Форма
```
interface IFormState {
    valid: boolean
    errors: string[]
}
```

Продукт
```
interface IProduct {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number | null
}
```
Карточка продукта превью с описанием
```
interface ICardProduct extends IProduct {
	button: string;
	state: boolean;
}
```
Корзина
```
interface IBasket {
    items: HTMLElement[]
    total: number
}
```
Нумерация товара в корзине
```
interface IIndex {
	index: number;
}
```
Контакты
```
interface IContacts {
    email: string
    phone: string
}
```
Заказ товара
```
interface IOrder extends IContacts {
    payment: number,
    address: string,
    total: number,
    items: string[]
}
```
Результат заказа
```
interface IOrderResult {
    id: string,
    total: number 
}
```
Успешный заказ
```
interface ISuccess {
    total: number; 
}
```
Результат успешного заказа
```
interface ISuccessActions {
    onClick: () => void;
}
```
Интерфейс для API
```
export interface ILarekApi {
    getProducts: () => Promise<IProduct[]>
    createOrder: (order: IOrder) => Promise<IOrderResult>
  }
```
Категория продукта
```
 enum ProductCategory {
	'софт-скил' = 'soft',
	'другое' = 'other',
	'хард-скил' = 'hard',
	'дополнительное' = 'additional',
	'кнопка' = 'кнопка'
}
```
Тип данных товара в корзине 
```
type TProductBakets = Pick<IProduct, 'id' | 'title' | 'price'>
```
Тип данных ошибок валидации форм
```
type TFormErrors = Partial<Record<keyof IOrder, string>>
 ```   

## Архитектура проекта

Код прилолжения разделен на части MVP парадигмы

* Слой модель данных для пользовательского интерфейса
* Слой представление показывает пользователю интерфейс
* Слой презентер управляет моделью и представлением

## Базовый код

### Класс Component
Базовый абстрактный класс **Component** является родителем для других класов представления.

Методы:

* `toggleClass` - переключает классы элемента
* `setText` - устанавливает текстовое содержимое
* `setDisabled` - меняет состояние блокировки. Устанавливает если его нет, убирает если оно есть
* `setHidden` - скрывает элемент
* `setVisible` - показывает элемент
* `setImage` - устанавливает изображение
* `render` - заполняет элемент данными


### Кдасс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Методы класса EventEmitter:

* `on` - устанавливает оброботчик событий
* `off` - снимает обработчик событий
* `emit` - инициировать событие с данными
* `onAll` - устанавливает все оброботчики событий 
* `offAll` - снимает все обработчики событий


### Класс Api
Класс Api реализует запросы на сервер

Методы класа Api:
* `get` - отправляет GET запрос на сервер и возвращает промис
* `post` - принимает обьект с данными в формате json и отправляет запрос на сервер

## Cлой данных

### Класс Model
Класс **Model** является базовым абстрактным классом для работы с моделью данных

Методы:

* `emitChanges` - сообщает всем что модель изменилась



### Класс AppData
Класс **AppData** отвечает за работу с данными приложения\
Расширяется базовым абстрактным классом `Model<T>` по интерфейсу `IAppData`.

Поля:
* `_catalog` - массив с объектами карточек товара 
* `_basket` - содержет в себе массив с объектами карточек товара которые находятся в корзине
* `_order` - текущий заказ
*  `_formErrors` - ошибки полей форм

Конструктор принимает инстанты (экземпляры) исходные данные, брокер событий, список товаров, список товаров в корзине, заказ.

Методы:

* `addProductToBasket` - добавление товара в корзину
* `removeProductFromBasket` - удаление товара из корзины
* `clearBasket` - очистка корзины
* `clearOrder` - очистка оформления заказа после успешной покупки
* `getBasket` - получаем товар из массива продуктов в корзину
* `getOrder` - метод для получения заказа товвра
* `setOrderField` - обновляет состояние полей форм
* `getTotalPrice` - выводит общую сумму заказа
* `setCatalog` - установка каталога товаров на странице
* `getCatalog` - получаем список товаров
* `validateOrder` - валидация форм заказа

### Класс LarekApi
Класс **LarekApi** отвечает за получение католога с товарами и оформление заказа.\
Данный класс расширяется базовым классом `Api` и интерфесом `ILarekApi`

Поле `cdn` хранит входящий `url`

Конструктор принимает инстанты (экземпляры) входящий url, базовый url для api, необязательный параметр для инициализации запроса.

Методы:

* `getProducts` - отправляет запрос на получение списка всех товаров
* `createOrder` - отправляет запрос для оформления заказа с указанными данными

## Слой представления

 ### Класс Modal
Класс **Modal** отвечвет за открытие и закрытие всех модальных окон на странице.\
Данный класс расширяется абстрактным классом `Component<T>` при помощи интерфейса `IModal`.

Поля:
 * `_closeButton` - кнопка закрытия модального окна
 * `_content` - содержимое модального окна

Конструктор принимает `container` типа `HTMLElement`, брокер событий.\
Параметр `container` передается в родительский конструктор.\
Внутри тела конструктора происходит сохранение элементов разметки,\
и также установлены обработчики событий модального окна. 

Также в классе имеется сеттер для установки содержимого контента внутри контейнера.

Методы:

* `open` - открывает модальное окно
* `close` - закрывает модальное окно
* `render` - рендеринг отрисовка модалки


### Класс Basket
Класс **Basket** служит для отображания списка выбранного товара в корзину.
Данный класс расширяется абстрактным классом `Component<T>` при помощи интерфейса `IBasket`.

Поля:

* `_list` - контейнер список товаров в корзине
* `_total` - общая сумма заказа
* `_button` - кнопка для перехода к оформлению заказа 

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLElement`, брокер событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик события для кнопки перехода к заказу товара.

Также в классе присутствует метод `disableButton` который позволяет блокировать кнопку для перехода к заказу

Использование сеттеров:
* `items` - устанавливает Html элемент в корзину\
 в случае если корзина пуста при помощи функции `createElement` создаётся элемент с текстом `Корзина пуста`\
 и блокируется кнопка перехода к заказу. 
* `total` - устанавливает общию сумму товаров в корзине.




### Класс Form<T>
Класс **Form** отвечает за работу с формами и ошибками полей форм.\
Расширяется абстрактным классом `Component<T>` при помощи интерфейса `IFormState`.

Поля:

* `_submit` - кнопка продолжение оформление заказа
* `_errors` - элемент отображение ошибок формы

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLFormElement`, брокер событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Слушатель `input` прикреплён ко всей форме `container`, он отслеживает и определяет имя поля и его значение.\
После чего отправляются методу  `onInputChange` в качестве аргументов.\
Слушатель `submit` прикреплён ко всей форме `container`, при помощи которого генерируется событие.\
`preventDefault()` предотвращает перезагрузку страницы по умолчанию.


Методы:

* `onInputChange` - метод обработки изменения поля ввода
* `render` - рендеринг отрисовка формы

Использование сеттеров:

* `valid` - установка валидности формы
* `errors` - установка ошибок валидации


### Класс Success
Класс **Success** уведомляет о успешном заказа в виде модального окна.\
Расширяется абстрактным классом `Component<T>` при помощи интерфейса `ISuccess`.

Поля: 

* `_buttonClose` - кнопка закрытия модального окна успешная покупка
* `_description` - элемент отображения теста и цены заказа

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLElement` и `actions` типа `ISuccessActions`.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Установлен обработчик для клика на кнопку `за новыми покупками`.


Использование ссетера `total` для установки итоговый суммы заказа в модальном окне.


### Класс Page
Класс **Page** отвечает за отображение содержимое страницы.\
Кдасс расширяется абстрактным классом `Component<T>` при помощи интерфейса `IPage`.

Поля:

* `_counter` - cчетчик корзины
* `_catalog` - каталог с товарами
* `_wrapper` - обертка страницы
* `_basket` - корзина

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLElement` и брокер событий.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Добавлен обработчик для открытия модального окна корзины.

Использование сеттеров:

* `counter` - установка количества товаров в корзине
* `catalog` - установка содержимого каталога
* `locked` - установка блокировки прокрутки страницы 



### Класс CardProduct
Класс **CardProduct** отвечает за отображение карточки товара на странице.\
Данный класс расширяется абстрактным классом `Component<T>` при помощи интерфейса `ICardProduct`.

Поля: 
* `_title` - заголовок продукта
* `_image` - изображение товара
* `_category` - категория товара
* `_description` - описание товара
* `_price` - цена товара
* `_button` - кнопка добавление товара в корзину

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLElement` и `actions` типа `ISuccessActions`.\
Параметр `container` передается в родительский конструктор.\
При помощи функции `ensureElement` и `querySelector` происходит сохранение элеметов разметки.\
Установлен обработчик для добавления товара в корзину.



Использование сеттеров:
* `category` - установка категории товара
* `title` - установка названия товара
* `image` - установка изображение товара
* `price` - установка цены товара
* `description` - установка описание товара
* `state` - установка состояние товара. если цена равна null(Бесценно) то меняется текст кнопки на `Недоступно`
  и блокируется кнопка добавление в корзину.


### Класс Order
Класс **Order** отвечает за начальный этап оформление заказа.
Расширяется классом `Form<T>` при помощи интерфейса `IOrder`.

Поля:

* `_buttonPaymentOnline` - способ оплаты онлайн
* `_buttonPaymentCash` - способ оплаты при получении
* `_inputAddress` - поле для указания адреса доставки
* `_buttonSubmit` - кнопка для продолжения заказа

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLFormElement` и брокер событий.\
Параметр `container` и параметр `events` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Установлен обработчик событий для выбора способа оплаты и обработчик для продолжение оформление заказа.

Использование сеттеров:

* `payment` - Установка для выбора способы оплаты
* `address` -  Установка значение поля адрес


### Класс Contacts
Класс **Contacts** отвечает за продолжение заказа.\
Расширяется классом `Form<T>` при помощи интерфейса `IContacts`.

Поля:
* `_buttonSubmit` - кнопка отправление заказа

Конструктор принимает инстанты (экземпляры) `container` типа `HTMLFormElement` и брокер событий.\
Параметр `container` и параметр `events` передается в родительский конструктор.\
При помощи функции `ensureElement` происходит сохранение элеметов разметки.\
Установлен обработчик для отправки заказа.

Использование сеттеров:

* `phone` - Установка значение поля номера
* `email` - Установка значение электроной почты

## Слой представитель

За слой представителя он же презентер отвечает файл `src/index.js` внутри которого взаимодействуют слой представления и модели данных между собой, за счет брокера событий и экземпляров классов.
Сначала создаются экземпляры классов после чего устанавливаются обработчики событий.

### События:

* `products:changed` - изменение списка продуктов
* `basket:changed` - изменилось состояние списка товаров в корзине
* `order:changed` - изменилось состояние оформление заказа
* `order:ready` - если заказа действителен отправляется событие о готовности заказа
* `formErrors:changed` - изменилось состояние ошибок форм
* `product:openModal` - открытие модального окна превью товара
* `product:addToBasket` - добавление товара в корзину
* `product:removeFromBasket` - удаление товара из корзины
* `basket:open` - открытие корзины
* `/(^order|^contacts)\..*:change/` - изменилось состояние полей форм
* `order:open` - переход к оформлению заказа
* `contacts:open` - переход к форме контактов
* `order:submit` - отправка заказа
* `modal:open` - открытие модального окна
* `modal:close` - закрытие модального окна
* `clear:basket` - очистка корзины
* `clear:order` - очистка заказа